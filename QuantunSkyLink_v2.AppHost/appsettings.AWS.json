{
  "$schema": "https://json.schemastore.org/appsettings.json",
  "AWS": {
    "Profile": "${AWS_PROFILE:default}",
    "Region": "${AWS_REGION:us-east-1}",
    "Deployment": {
      "Environment": "${DEPLOYMENT_ENV:staging}",
      "StackPrefix": "qsl-${DEPLOYMENT_ENV}",
      "ClusterName": "qsl-${DEPLOYMENT_ENV}-cluster"
    },
    "ECS": {
      "TaskCpu": "256",
      "TaskMemory": "512",
      "DesiredCount": 1,
      "EnableAutoScaling": false,
      "MinTasks": 1,
      "MaxTasks": 3,
      "ScaleUpCooldown": 300,
      "ScaleDownCooldown": 300,
      "TargetCPUUtilization": 70
    },
    "CloudFormation": {
      "Templates": {
        "DeployRole": "infra/aws/qsl-deploy-role.template.json",
        "Messaging": "infra/aws/aws-messaging.template.json",
        "Network": "infra/aws/network-stack.template.json",
        "Compute": "infra/aws/ecs-cluster.template.json",
        "Storage": "infra/aws/storage-stack.template.json"
      }
    },
    "EventBridge": {
      "Enabled": "${EVENTBRIDGE_ENABLED:false}",
      "Buses": {
        "Core": "qsl-${DEPLOYMENT_ENV}-core",
        "Financial": "qsl-${DEPLOYMENT_ENV}-financial",
        "Blockchain": "qsl-${DEPLOYMENT_ENV}-blockchain",
        "Business": "qsl-${DEPLOYMENT_ENV}-business",
        "System": "qsl-${DEPLOYMENT_ENV}-system"
      },
      "RulePrefix": "qsl-${DEPLOYMENT_ENV}",
      "ArchiveRetentionDays": 7
    },
    "SQS": {
      "QueuePrefix": "qsl-${DEPLOYMENT_ENV}",
      "DefaultVisibilityTimeout": 30,
      "MessageRetentionPeriod": 345600,
      "MaxReceiveCount": 3,
      "DeadLetterQueue": {
        "Enabled": true,
        "RetentionPeriod": 1209600
      },
      "FifoQueues": [
        "qsl-${DEPLOYMENT_ENV}-ledger-transactions.fifo",
        "qsl-${DEPLOYMENT_ENV}-payment-processing.fifo"
      ],
      "StandardQueues": [
        "qsl-${DEPLOYMENT_ENV}-user-inbox",
        "qsl-${DEPLOYMENT_ENV}-notification-inbox",
        "qsl-${DEPLOYMENT_ENV}-compliance-inbox"
      ]
    },
    "SNS": {
      "TopicPrefix": "qsl-${DEPLOYMENT_ENV}",
      "Topics": [
        "qsl-${DEPLOYMENT_ENV}-user-events",
        "qsl-${DEPLOYMENT_ENV}-payment-events",
        "qsl-${DEPLOYMENT_ENV}-system-alerts"
      ]
    },
    "S3": {
      "BucketPrefix": "qsl-${DEPLOYMENT_ENV}",
      "Buckets": {
        "Frontend": "qsl-${DEPLOYMENT_ENV}-frontend",
        "Uploads": "qsl-${DEPLOYMENT_ENV}-uploads",
        "Backups": "qsl-${DEPLOYMENT_ENV}-backups",
        "Logs": "qsl-${DEPLOYMENT_ENV}-logs"
      },
      "Versioning": true,
      "Encryption": "AES256",
      "LifecycleRules": {
        "LogsRetentionDays": 30,
        "BackupsRetentionDays": 90,
        "ArchiveAfterDays": 30
      }
    },
    "CloudFront": {
      "Enabled": true,
      "PriceClass": "PriceClass_100",
      "DefaultCacheBehavior": {
        "TTL": 86400,
        "MinTTL": 0,
        "MaxTTL": 31536000
      },
      "Origins": {
        "S3": "qsl-${DEPLOYMENT_ENV}-frontend.s3.amazonaws.com",
        "ALB": "qsl-${DEPLOYMENT_ENV}-alb.us-east-1.elb.amazonaws.com"
      },
      "OAC": {
        "Enabled": true,
        "SigningBehavior": "always",
        "SigningProtocol": "sigv4"
      }
    },
    "RDS": {
      "Note": "Not used - Neon PostgreSQL is the primary database",
      "Enabled": false
    },
    "SecretsManager": {
      "Enabled": true,
      "SecretPrefix": "qsl/${DEPLOYMENT_ENV}/",
      "RotationEnabled": true,
      "RotationSchedule": "rate(30 days)",
      "Secrets": [
        "qsl/${DEPLOYMENT_ENV}/neon/connection",
        "qsl/${DEPLOYMENT_ENV}/jwt/secret",
        "qsl/${DEPLOYMENT_ENV}/blockchain/keys",
        "qsl/${DEPLOYMENT_ENV}/api/keys",
        "qsl/${DEPLOYMENT_ENV}/logto/credentials"
      ]
    },
    "ParameterStore": {
      "Prefix": "/qsl/${DEPLOYMENT_ENV}/config/",
      "Parameters": [
        "/qsl/${DEPLOYMENT_ENV}/config/environment",
        "/qsl/${DEPLOYMENT_ENV}/config/region",
        "/qsl/${DEPLOYMENT_ENV}/config/cluster",
        "/qsl/${DEPLOYMENT_ENV}/config/features"
      ]
    },
    "CloudWatch": {
      "LogGroupPrefix": "/ecs/qsl-${DEPLOYMENT_ENV}",
      "RetentionInDays": 30,
      "MetricNamespace": "QuantumSkyLink/${DEPLOYMENT_ENV}",
      "Dashboards": [
        "qsl-${DEPLOYMENT_ENV}-overview",
        "qsl-${DEPLOYMENT_ENV}-services",
        "qsl-${DEPLOYMENT_ENV}-business"
      ],
      "Alarms": {
        "Enabled": true,
        "SNSTopic": "qsl-${DEPLOYMENT_ENV}-alerts",
        "Thresholds": {
          "ErrorRate": 5,
          "Latency": 1000,
          "CPUUtilization": 80,
          "MemoryUtilization": 90
        }
      }
    },
    "VPC": {
      "CreateNew": true,
      "CidrBlock": "10.0.0.0/16",
      "EnableDnsHostnames": true,
      "EnableDnsSupport": true,
      "Subnets": {
        "Public": ["10.0.1.0/24", "10.0.2.0/24"],
        "Private": ["10.0.10.0/24", "10.0.11.0/24"]
      },
      "NATGateways": 1,
      "VPCEndpoints": [
        "com.amazonaws.${AWS_REGION}.s3",
        "com.amazonaws.${AWS_REGION}.secretsmanager",
        "com.amazonaws.${AWS_REGION}.ecr.api",
        "com.amazonaws.${AWS_REGION}.ecr.dkr"
      ]
    },
    "IAM": {
      "RolePrefix": "qsl-${DEPLOYMENT_ENV}",
      "Roles": {
        "Deploy": "qsl-${DEPLOYMENT_ENV}-deploy-role",
        "TaskExecution": "qsl-${DEPLOYMENT_ENV}-task-execution-role",
        "TaskRole": "qsl-${DEPLOYMENT_ENV}-task-role",
        "Lambda": "qsl-${DEPLOYMENT_ENV}-lambda-role"
      },
      "Policies": {
        "LeastPrivilege": true,
        "MFARequired": false,
        "MaxSessionDuration": 3600
      }
    },
    "ECR": {
      "RepositoryPrefix": "qsl/${DEPLOYMENT_ENV}",
      "ImageTagMutability": "MUTABLE",
      "ScanOnPush": true,
      "LifecyclePolicy": {
        "MaxImageAge": 30,
        "MaxImageCount": 10
      }
    },
    "Lambda": {
      "Runtime": "dotnet8",
      "MemorySize": 512,
      "Timeout": 30,
      "ReservedConcurrentExecutions": 10,
      "Environment": {
        "ASPNETCORE_ENVIRONMENT": "${DEPLOYMENT_ENV}",
        "AWS_LAMBDA_HANDLER": "bootstrap"
      }
    },
    "Tags": {
      "Project": "QuantumSkyLink",
      "Environment": "${DEPLOYMENT_ENV}",
      "ManagedBy": "Aspire",
      "Version": "2.0",
      "CostCenter": "Engineering",
      "Team": "Platform"
    }
  },
  "Deployment": {
    "Strategy": "rolling",
    "HealthCheckGracePeriod": 60,
    "DeregistrationDelay": 30,
    "StopTimeout": 30,
    "RollbackOnFailure": true,
    "EnableCircuitBreaker": true,
    "CircuitBreakerRollback": true
  }
}